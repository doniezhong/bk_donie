<%inherit file="/base.html"/>

<%block name="content">
<div id="app" class="app" v-cloak>
    <div>{{ businessList }}</div>
    <div id="main" style="width: 100%;height: 400px;border:1px solid #ddd;"></div>
</div>
<style>
    [v-cloak] {
        display: none !important;
    }
</style>
</%block>

<script>
    Vue.prototype.$http = axios;
    axios.interceptors.response.use(response => {
        if (response.status !== 200) {
            return {
                code: response.status,
                message: '请求异常，请刷新重试',
                result: false
            }
        }
        return response.data
    });
    Vue.use(iview);
    new Vue({
        el: '#app',
        data() {
            return {
                businessList: []
            }
        },
        mounted() {
            this.searchBusiness();
            let chartOption = {
                title: 'Echart示例',
                data: [
                    {
                        title: '业务A',
                        value: 10
                    },
                    {
                        title: '业务B',
                        value: 15
                    }
                ],
                legend: '主机',
                type: 'line'
            };
            this.initChart(chartOption);
        },
        methods: {
            searchBusiness() {
                this.$http.post('search_business/').then(res => {
                    if (res.result) {
                        this.businessList = res.data;
                    } else {
                        this.$Message.error(res.message);
                    }
                });
            },
            initChart(params) {
                let titleKey = params.titleKey ? params.titleKey : 'title';
                let valueKey = params.valueKey ? params.valueKey : 'value';
                let xAxis = [];
                let series = [];
                params.data.forEach((item) => {
                    xAxis.push(item[titleKey]);
                    series.push(item[valueKey])
                });
                let option = {
                    title: {
                        text: params.title
                    },
                    tooltip: {},
                    legend: {
                        data: [params.legend ? params.legend : '']
                    },
                    xAxis: {
                        data: xAxis
                    },
                    yAxis: {},
                    series: [{
                        name: params.legend ? params.legend : '',
                        type: params.type ? params.type : 'bar',
                        data: series
                    }]
                };
                let myChart = echarts.init(document.getElementById('main'));
                myChart.setOption(option);
            }
        },
    })
</script>
<style>
    .app {
        padding: 10px !important;
        overflow: hidden;
    }
</style>

